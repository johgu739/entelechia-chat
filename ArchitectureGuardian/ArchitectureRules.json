{
  "targets": {
    "ChatUI": {
      "allowedImports": ["Foundation", "SwiftUI", "UIConnections", "UIContracts", "AppKit", "Combine"],
      "forbidden": [
        {
          "regex": "GeometryReader",
          "message": "GeometryReader is only allowed in ChatUI/Shared/SizeReader.swift",
          "excludedPaths": ["ChatUI/Sources/ChatUI/Shared/SizeReader.swift"],
          "excludedTargets": ["ChatUITests"]
        },
        {
          "regex": "^import\\s+(AppCoreEngine|AppAdapters)\\b",
          "message": "ChatUI must not import AppCoreEngine/AppAdapters."
        },
        {
          "regex": "UIConnections\\.(ContextScopeChoice|ModelChoice|NavigatorMode|InspectorTab|WorkspaceViewState|ConversationViewState|ContextSnapshot|ContextFileDescriptor|ContextSegmentDescriptor|RecentProject|WorkspaceScope)",
          "message": "ChatUI must use UIContracts types, not UIConnections types. Import UIContracts instead."
        },
        {
          "regex": "\\.(onAppear|onChange|task|onReceive)\\s*\\([^)]*\\)\\s*\\{[^}]*\\b(WorkspaceViewModel|ChatViewModel|ConversationCoordinator|CodexService)\\b[^}]*\\}",
          "message": "Lifecycle modifiers must not reference WorkspaceViewModel, ChatViewModel, ConversationCoordinator, or CodexService. Move logic to view-model methods.",
          "excludedTargets": ["ChatUITests"]
        },
        {
          "regex": "\\.onChange\\s*\\([^)]*\\)\\s*\\{[^}]*\\bawait\\b",
          "message": ".onChange blocks must not contain await. Use view-model async flows instead.",
          "excludedTargets": ["ChatUITests"]
        },
        {
          "regex": "\\.task\\s*\\(",
          "message": ".task modifier is forbidden in ChatUI. Use view-model async flows instead.",
          "excludedTargets": ["ChatUITests"]
        },
        {
          "regex": "\\.onReceive\\s*\\(",
          "message": ".onReceive is forbidden in ChatUI except for keyboard/animation/size publishers. Move event handling to view models.",
          "excludedTargets": ["ChatUITests"],
          "excludedPaths": ["ChatUI/Sources/ChatUI/Design/KeyboardAdaptiveInset.swift"]
        }
      ]
    },
    "ChatUITests": {
      "allowedImports": ["Foundation", "XCTest", "ChatUI", "UIContracts", "SwiftUI", "AppKit", "Combine", "Darwin"]
    },
    "UIConnections": {
      "allowedImports": ["Foundation", "Combine", "os", "os.log", "AppCoreEngine", "AppAdapters", "UIContracts"],
      "forbidden": [
        {
          "regex": "^import\\s+SwiftUI\\b",
          "message": "UIConnections cannot import SwiftUI."
        },
        {
          "regex": "^import\\s+AppAdapters\\b",
          "message": "UIConnections cannot import AppAdapters. File mutation must go through AppCoreEngine protocols only."
        },
        {
          "regex": "FileMutationAuthority|AtomicDiffApplying|FileMutationAuthorizing",
          "message": "UIConnections cannot reference file mutation adapters. Use FileMutationPlanning protocol from AppCoreEngine."
        },
        {
          "regex": "WorkspaceViewModel.*(workspaceEngine|conversationEngine|codexService|projectTodosLoader|alertCenter|DomainErrorAuthority)\\s*[:=]",
          "message": "WorkspaceViewModel cannot store engine dependencies. Pass to coordinator only."
        },
        {
          "regex": "WorkspaceViewModel.*DomainErrorAuthority\\(\\)",
          "message": "WorkspaceViewModel cannot create DomainErrorAuthority. Must be injected."
        },
        {
          "regex": "alertCenter\\.publish|contextErrorSubject\\.send",
          "message": "UIConnections cannot publish errors directly. Use DomainErrorAuthority only."
        }
      ]
    },
    "UIConnectionsTests": {
      "allowedImports": ["Foundation", "XCTest", "UIConnections", "Combine", "os", "os.log", "AppCoreEngine", "UIContracts"]
    },
    "AppComposition": {
      "allowedImports": ["Foundation", "SwiftUI", "ChatUI", "UIConnections", "AppAdapters", "AppCoreEngine"]
    },
    "AppCompositionTests": {
      "allowedImports": ["Foundation", "XCTest", "AppComposition", "ChatUI", "UIConnections", "AppAdapters", "AppCoreEngine"]
    },
    "AppAdapters": {
      "allowedImports": ["Foundation", "os", "os.log", "Dispatch", "AppCoreEngine", "Security", "UniformTypeIdentifiers", "CoreServices", "AppKit"]
    },
    "AppAdaptersTests": {
      "allowedImports": ["Foundation", "XCTest", "AppAdapters", "AppCoreEngine", "UniformTypeIdentifiers"]
    },
    "AppCoreEngine": {
      "allowedImports": ["Foundation", "Dispatch"],
      "forbidden": [
        {
          "regex": "^import\\s+(SwiftUI|AppKit|UIConnections|ChatUI|UIContracts)\\b",
          "message": "AppCoreEngine cannot import UI modules."
        }
      ]
    },
    "UIContracts": {
      "allowedImports": ["Foundation"],
      "forbidden": [
        {
          "regex": "^import\\s+(SwiftUI|Combine|UIConnections|AppCoreEngine|AppAdapters|ChatUI)\\b",
          "message": "UIContracts cannot import SwiftUI, Combine, UIConnections, AppCoreEngine, AppAdapters, or ChatUI. Zero dependencies."
        },
        {
          "regex": "ObservableObject|@Published|@StateObject|@ObservedObject",
          "message": "UIContracts cannot define ObservableObject or @Published properties. Pure value types only."
        },
        {
          "regex": "func\\s+\\w+\\s*\\([^)]*\\)\\s*\\{",
          "message": "UIContracts cannot define method bodies. Protocols and structs only."
        }
      ]
    },
    "AppCoreEngineTests": {
      "allowedImports": ["Foundation", "XCTest", "AppCoreEngine"]
    },
    "OntologyCore": {
      "allowedImports": ["Foundation", "Dispatch"]
    },
    "OntologyAct": {
      "allowedImports": ["Foundation", "Dispatch", "OntologyCore"]
    },
    "OntologyState": {
      "allowedImports": ["Foundation", "Dispatch", "OntologyAct", "OntologyCore"]
    },
    "OntologyTeleology": {
      "allowedImports": ["Foundation", "Dispatch", "OntologyState", "OntologyAct", "OntologyCore"]
    },
    "OntologyIntelligence": {
      "allowedImports": ["Foundation", "Dispatch", "OntologyTeleology", "OntologyState", "OntologyAct", "OntologyCore"]
    },
    "OntologyFractal": {
      "allowedImports": ["Foundation", "Dispatch", "OntologyIntelligence", "OntologyTeleology", "OntologyState", "OntologyAct", "OntologyCore"]
    },
    "OntologyIntegration": {
      "allowedImports": ["Foundation", "Dispatch", "OntologyFractal", "OntologyIntelligence", "OntologyTeleology", "OntologyState", "OntologyAct", "OntologyCore"]
    },
    "OntologyDomain": {
      "allowedImports": ["Foundation", "Dispatch", "OntologyIntegration", "OntologyFractal", "OntologyIntelligence", "OntologyTeleology", "OntologyState", "OntologyAct", "OntologyCore"]
    }
  },
  "globalForbidden": [
    {
      "regex": "WorkspaceEngineImpl\\(",
      "message": "WorkspaceEngineImpl must only be constructed in AppComposition.",
      "excludedTargets": ["AppComposition"]
    },
    {
      "regex": "ProjectEngineImpl\\(",
      "message": "ProjectEngineImpl must only be constructed in AppComposition.",
      "excludedTargets": ["AppComposition"]
    },
    {
      "regex": "ConversationEngineLive\\(",
      "message": "ConversationEngineLive must only be constructed in AppComposition.",
      "excludedTargets": ["AppComposition"]
    },
    {
      "regex": "CodexService\\(",
      "message": "CodexService must be composed in AppComposition.",
      "excludedTargets": ["AppComposition"]
    },
    {
      "regex": "FileMutationAuthority\\(",
      "message": "FileMutationAuthority must be composed in AppComposition.",
      "excludedTargets": ["AppComposition"]
    },
    {
      "regex": "ProjectStoreRealAdapter\\(",
      "message": "ProjectStoreRealAdapter must be composed in AppComposition.",
      "excludedTargets": ["AppComposition"]
    },
    {
      "regex": "extension WorkspaceViewModel.*\\{[^}]*func (sendMessage|askCodex|openWorkspace|selectPath|currentWorkspaceScope|buildContextSnapshot)",
      "message": "WorkspaceViewModel extensions cannot contain orchestration logic. All logic must be in WorkspaceCoordinator.",
      "excludedPaths": ["UIConnections/Sources/UIConnections/Workspaces/WorkspaceViewModel+*.swift"]
    }
  ]
}
